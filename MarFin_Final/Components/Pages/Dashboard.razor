@page "/dashboard"
@inject NavigationManager Navigation
@inject AuthService AuthService

@code {
    protected override void OnInitialized()
    {
        if (!AuthService.IsAuthenticated)
        {
            Navigation.NavigateTo("/login", true);
        }
    }
}

<div class="dashboard-container">
    <!-- Dashboard Header with Export -->
    <div class="dashboard-header">
        <div>
            <h1>Dashboard Overview</h1>
            <p class="subtitle">Monitor your business performance</p>
        </div>
        <div class="header-actions">
            <button class="export-btn">
                <i class="bi bi-download"></i>
                Export Report
                <i class="bi bi-chevron-down"></i>
            </button>
        </div>
    </div>

    <!-- Date Range Filters -->
    <div class="date-filters">
        <button class="filter-btn @(selectedFilter == "thisMonth" ? "active" : "")" @onclick='() => SetFilter("thisMonth")'>
            This Month
        </button>
        <button class="filter-btn @(selectedFilter == "last3Months" ? "active" : "")" @onclick='() => SetFilter("last3Months")'>
            Last 3 Months
        </button>
        <button class="filter-btn @(selectedFilter == "custom" ? "active" : "")" @onclick='() => SetFilter("custom")'>
            Custom Range
        </button>
        <div class="date-inputs">
            <input type="date" class="date-input" @bind="startDate" />
            <span>-</span>
            <input type="date" class="date-input" @bind="endDate" />
        </div>
    </div>

    <!-- Stats Cards Row -->
    <div class="stats-row">
        <div class="stat-card">
            <div class="stat-icon customers">
                <i class="bi bi-people-fill"></i>
            </div>
            <div class="stat-content">
                <p class="stat-label">Customers</p>
                <h2>1,248</h2>
                <span class="stat-change positive">
                    <i class="bi bi-arrow-up"></i> +12%
                </span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon revenue">
                <i class="bi bi-currency-dollar"></i>
            </div>
            <div class="stat-content">
                <p class="stat-label">Revenue</p>
                <h2>₱2.4M</h2>
                <span class="stat-change positive">
                    <i class="bi bi-arrow-up"></i> +28%
                </span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon campaigns">
                <i class="bi bi-megaphone-fill"></i>
            </div>
            <div class="stat-content">
                <p class="stat-label">Campaigns</p>
                <h2>12</h2>
                <span class="stat-change positive">
                    <i class="bi bi-arrow-up"></i> +8%
                </span>
            </div>
        </div>

        <div class="stat-card">
            <div class="stat-icon conversion">
                <i class="bi bi-graph-up-arrow"></i>
            </div>
            <div class="stat-content">
                <p class="stat-label">Conversion</p>
                <h2>24.5%</h2>
                <span class="stat-change positive">
                    <i class="bi bi-arrow-up"></i> +15%
                </span>
            </div>
        </div>
    </div>

    <!-- Charts Row -->
    <div class="charts-row">
        <!-- Revenue Trend Chart -->
        <div class="chart-card revenue-chart">
            <div class="card-header">
                <h3>Revenue Trend</h3>
                <div class="chart-filter">
                    <button class="mini-filter-btn @(revenueFilter == "monthly" ? "active" : "")" @onclick='() => revenueFilter = "monthly"'>Monthly</button>
                    <button class="mini-filter-btn @(revenueFilter == "quarterly" ? "active" : "")" @onclick='() => revenueFilter = "quarterly"'>Quarterly</button>
                    <button class="mini-filter-btn @(revenueFilter == "yearly" ? "active" : "")" @onclick='() => revenueFilter = "yearly"'>Yearly</button>
                </div>
            </div>
            <div class="chart-content">
                <div class="bar-chart">
                    @foreach (var month in revenueData)
                    {
                        <div class="bar-item">
                            <div class="bar" style="height: @(month.Value * 2)px"></div>
                            <span class="bar-label">@month.Month</span>
                        </div>
                    }
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="chart-card activity-card">
            <div class="card-header">
                <h3>Recent Activity</h3>
                <button class="refresh-icon"><i class="bi bi-arrow-clockwise"></i></button>
            </div>
            <div class="activity-list">
                @foreach (var activity in recentActivities)
                {
                    <div class="activity-item">
                        <div class="activity-icon-dot @activity.Type"></div>
                        <div class="activity-details">
                            <p class="activity-text">@activity.Text</p>
                            <span class="activity-time">@activity.Time</span>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Recent Transactions -->
    <div class="transactions-section">
        <div class="section-header">
            <h3>Recent Transactions</h3>
            <a href="/financial" class="view-all-link">View All <i class="bi bi-arrow-right"></i></a>
        </div>
        <div class="transactions-table">
            <div class="table-header">
                <span>Invoice</span>
                <span>Customer</span>
                <span>Amount</span>
                <span>Date</span>
                <span>Status</span>
            </div>
            @foreach (var transaction in recentTransactions)
            {
                <div class="table-row">
                    <span class="transaction-invoice">@transaction.Invoice</span>
                    <span class="transaction-customer">@transaction.Customer</span>
                    <span class="transaction-amount">@transaction.Amount</span>
                    <span class="transaction-date">@transaction.Date</span>
                    <span class="transaction-status @transaction.Status.ToLower()">@transaction.Status</span>
                </div>
            }
        </div>
    </div>
</div>

@code {
    private string selectedFilter = "thisMonth";
    private string revenueFilter = "monthly";
    private DateTime startDate = DateTime.Now.AddDays(-7);
    private DateTime endDate = DateTime.Now;

    private void SetFilter(string filter)
    {
        selectedFilter = filter;

        if (filter == "thisMonth")
        {
            startDate = new DateTime(DateTime.Now.Year, DateTime.Now.Month, 1);
            endDate = DateTime.Now;
        }
        else if (filter == "last3Months")
        {
            startDate = DateTime.Now.AddMonths(-3);
            endDate = DateTime.Now;
        }
    }

    private class RevenueMonth
    {
        public string Month { get; set; } = "";
        public int Value { get; set; }
    }

    private class Activity
    {
        public string Text { get; set; } = "";
        public string Time { get; set; } = "";
        public string Type { get; set; } = "";
    }

    private class Transaction
    {
        public string Invoice { get; set; } = "";
        public string Customer { get; set; } = "";
        public string Amount { get; set; } = "";
        public string Date { get; set; } = "";
        public string Status { get; set; } = "";
    }

    private List<RevenueMonth> revenueData = new()
    {
        new() { Month = "May", Value = 45 },
        new() { Month = "Jun", Value = 65 },
        new() { Month = "Jul", Value = 85 },
        new() { Month = "Aug", Value = 100 },
        new() { Month = "Sep", Value = 90 },
        new() { Month = "Oct", Value = 75 }
    };

    private List<Activity> recentActivities = new()
    {
        new() { Text = "New customer registered", Time = "2 min ago", Type = "success" },
        new() { Text = "Payment received from ABC Corp", Time = "15 min ago", Type = "success" },
        new() { Text = "Campaign sent to 500 customers", Time = "1 hour ago", Type = "info" },
        new() { Text = "New order placed - INV-003", Time = "2 hours ago", Type = "info" },
        new() { Text = "Customer support ticket opened", Time = "3 hours ago", Type = "warning" }
    };

    private List<Transaction> recentTransactions = new()
    {
        new() { Invoice = "INV-001", Customer = "ABC Corp", Amount = "₱25,000", Date = "Oct 20", Status = "Paid" },
        new() { Invoice = "INV-002", Customer = "XYZ Ltd", Amount = "₱18,500", Date = "Oct 19", Status = "Pending" },
        new() { Invoice = "INV-003", Customer = "Design Co.", Amount = "₱32,000", Date = "Oct 18", Status = "Paid" },
        new() { Invoice = "INV-004", Customer = "Tech Solutions", Amount = "₱15,750", Date = "Oct 17", Status = "Paid" },
        new() { Invoice = "INV-005", Customer = "Marketing Plus", Amount = "₱22,300", Date = "Oct 16", Status = "Pending" }
    };
}